% `calc_metabolic_metrics`: Compute the solution from flux balance analysis
% and flux variability analysis. 
% @author: Scott Campit

function [solution, reactionFlux, reducedCosts, shadowPrice, maxFlux, minFlux] = ...
    calc_metabolic_metrics(input_model, reaction_positions, metabolites_of_interest, ...
    grate, sense, fva_rxns, objCoef, exp)

switch exp
    case {'sra', 'no_competition', 'competition'}
        input_model.c(reaction_positions) = objCoef;
        solution = optimizeCbModel(input_model);
        solution.reactionFlux = solution.v(reaction_positions);
        solution.reducedCosts = solution.w(reaction_positions);
        solution.shadowPrice = solution.y(find(ismember(input_model.mets, ...
            metabolites_of_interest)));
        solution.maxFlux = [];
        solution.minFlux = [];
        
        if reaction_positions == find(ismember(input_model.rxns, ...
                'biomass_objective'))
            input_model.c(reaction_positions) = 1;
        else
            input_model.c(reaction_positions) = 0;
        end

    case 'fva'
        [minFlux, maxFlux] = fluxVariability(input_model, grate, sense, fva_rxns);
        solution.name = 'FluxVariabilityAnalysis';
        solution.minflux = minFlux;
        solution.maxflux = maxFlux;
        solution.reactionFlux = [];
        solution.shadowPrice = [];
        solution.reducedCosts = [];
end

end